<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>üôÇ L√∂sung: Fragen zu jTodo</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div class="container">
            <h1>Jakarta Enterprise Edition</h1>
            <h2>L√∂sung zu den Fragen zu jTodo üìÖ</h2>
        </div>

        <div class="container">
            <h2>1. Umsetzung der MVC-Architektur</h2>

            <p>
                <span class="nr">a)</span>
                Inhalte der einzelnen Pakete:
            </p>
            <table>
                <thead>
                    <tr>
                        <th>
                            Paket
                        </th>
                        <th>
                            Inhalt
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td>
                        <tt>dhbwka.wwi.vertsys.javaee.jtodo</tt>
                    </td>
                    <td>
                        Oberpaket der gesamten Anwendung
                    </td>
                </tr>

                <tr>
                    <td>
                        &nbsp;&nbsp; <tt>common</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; √úbergreifende Anwendungsfunktionen
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>ejb</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Enterprise Java Beans als Serviceschicht
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>jpa</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Persistence Entities f√ºr das Datenmodell
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>web</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Servlets und Klassen f√ºr die Weboberfl√§che
                    </td>
                </tr>

                <tr>
                    <td>
                        &nbsp;&nbsp; <tt>dashboard</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; Alles rund um die Dashboard-Ansicht
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>ejb</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Enterprise Java Beans als Serviceschicht
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>web</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Servlets und Klassen f√ºr die Weboberfl√§che
                    </td>
                </tr>

                <tr>
                    <td>
                        &nbsp;&nbsp; <tt>tasks</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; Verwaltung von Aufgaben und Kategorien
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>ejb</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Enterprise Java Beans als Serviceschicht
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>jpa</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Persistence Entities f√ºr das Datenmodell
                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; <tt>web</tt>
                    </td>
                    <td>
                        &nbsp;&nbsp; &nbsp;&nbsp; Servlets und Klassen f√ºr die Weboberfl√§che
                    </td>
                </tr>
            </table>

            <p class="bigskip">
                <span class="nr">b)</span>
                Zuordnung der Quellcodes zu den Schichten von Model-View-Controller:
            </p>
            <table>
                <thead>
                    <tr>
                        <th>
                            Quellcode
                        </th>
                        <th>
                            MVC-Schicht
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td>
                        Ordner <tt>Web</tt> <tt>Pages</tt>
                    </td>
                    <td>
                        View
                    </td>
                </tr>
                <tr>
                    <td>
                        EJBs und Entities
                    </td>
                    <td>
                        Model
                    </td>
                </tr>
                <tr>
                    <td>
                        Servlets
                    </td>
                    <td>
                        Controller
                    </td>
                </tr>
            </table>

            <p class="bigskip">
                <span class="nr">c)</span>
                Schritte im <tt>TaskListServlet</tt> beim Aufruf der √úbersichtsliste:
            </p>
            <ol class="spacing">
                <li>
                    Am Anfang der Servletklasse werden mit <tt>@EJB</tt> Referenzen auf alle ben√∂tigten Enterprise Java Beans definiert.
                    Als Methode besitzt das Servlet nur die <tt>doGet()</tt>, um auf GET-Anfragen reagieren zu k√∂nnen. Alle anderen
                    HTTP-Verben werden ignoriert.
                </li>
                <li>
                    Innerhalb der <tt>doGet()</tt>-Methode werden zun√§chst alle Kategorien und alle Statuswerte ermittelt und im
                    Request Context abgelegt. Auf diese Weise stehen die Werte sp√§ter in der JSP zur Verf√ºgung.
                </li>
                <li>
                    Anschlie√üend werden die drei URL-Parameter und/oder Formularwerte <tt>search_text</tt>, <tt>search_category</tt>
                    und <tt>search_status</tt> ausgelesen. Bei einem normalen Aufruf der √úbersichtsseite sind diese leer. Beim Aufruf
                    der Seite √ºber das Dashboard werden sie jedoch √ºbergeben, um die Liste einzuschr√§nken. Au√üerdem befindet sich
                    innerhalb der √úbersichtsseite ein Suchformular, das die Werte ebenfalls √ºbergeben kann.
                </li>
                <li>
                    √úber die Methode <tt>this.taskBean.search()</tt> werden die gew√ºnschten Aufgaben aus der Datenbank gelesen und
                    anschlie√üend im Request Context abgelegt.
                </li>
                <li>
                    Zum Schluss wird die Bearbeitung an die <tt>/WEB-INF/tasks/task_list.jsp</tt> √ºbergeben, um den anzuzeigenden
                    HTML-Code zu generieren.
                </li>
            </ol>

            <p class="bigskip">
                <span class="nr">d)</span>
                Generierung des HTML-Codes in der Datei <tt>WEB-INF\tasks\task_list.jsp</tt>:
            </p>
            <ol class="spacing">
                <li>
                    √úber das JSP-Element <tt>&lt;template:base&gt;</tt> wird das HTML-Grundger√ºst aus der Datei <tt>base.tag</tt>
                    angesprochen und in die Antwort gestellt.
                </li>
                <li>
                    Die Elemente <tt>&lt;jsp:attribute name="‚Ä¶"&gt;</tt> f√ºllen dabei die in der <tt>base.tag</tt> vordefinierten
                    Bereiche mit Inhalten. Die <tt>base.tag</tt> funktioniert somit wie eine Schablone f√ºr HTML-Seiten, die hier
                    mit Inhalt versehen wird.
                </li>
                <li>
                    Der Hauptteil der Seite befindet sich innerhalb von <tt>&lt;jsp:attribute name="content"&gt;</tt> und
                    <tt>&lt;/jsp:attribute&gt;</tt>. Hier wird die eigentliche Aufgabenliste erzeugt.
                </li>
                <li>
                    Oberhalb der Aufgabenliste wird mit <tt>&lt;form&gt;</tt> ein Formular zum Durchsuchen der Liste generiert.
                    Das Formular ist so gebaut, dass es beim Abschicken eine GET-Anfrage an den Server mit den drei Parametern
                    <tt>search_text</tt>, <tt>search_category</tt> und <tt>search_status</tt> sendet. Hierzu werden die im
                    Request Context abgelegten Kategorien und Statuswerte in Dropdown-Listen gestellt.
                </li>
                <li>
                    Mit <tt>&lt;c:choose&gt;&lt;c:when test="${empty tasks}"&gt;‚Ä¶</tt> wird gepr√ºft, ob es √ºberhaupt anzuzeigende
                    Aufgaben gibt. Wenn nicht, wird einfach nur ein Hinweistext ausgegeben, sonst eine tabellarische √úbersicht.
                </li>
                <li>
                    <tt>&lt;jsp:useBean id="utils" class="dhbwka.wwi.vertsys.javaee.jtodo.common.web.WebUtils"/&gt;</tt> <br />
                    stellt die Klasse <tt>WebUtils</tt> unter dem Namen <tt>utils</tt> zur Verf√ºgung, damit ihre Methoden in der
                    JSP aufgerufen werden k√∂nnen.
                </li>
                <li>
                    <tt>&lt;c:forEach items="${tasks}" var="task"&gt;</tt> bildet eine Schleife √ºber alle im Request Context
                    abgelegten Aufgabenobjekte.
                </li>
                <li>
                    Innerhalb der Schleife werden mit <tt>&lt;c:out value="${task.‚Ä¶}"/&gt;</tt> die einzelnen Werte der Aufgaben ausgegeben.
                </li>
            </ol>

            <p class="bigskip">
                <span class="nr">e)</span>
                Die JSP-Dateien liegen im Unterverzeichnis <tt>WEB-INF</tt>, damit der Anwender sie nicht ohne Umweg √ºber ein
                vorgeschaltetes Servlet aufrufen kann. W√ºrden sie direkt im Ordner <tt>Web</tt> <tt>Pages</tt> liegen, h√§tte
                jede JSP eine eigene URL, √ºber die sie per HTTP aufgerufen werden k√∂nnte. Im Order <tt>WEB-INF</tt> werden sie
                stattdessen vor direkten Aufrufen ‚Äûversteckt‚Äù, so dass jede HTTP-Anfrage erst an ein Servlet geschickt werden
                muss, welches die anzuzeigenden Daten im Request Context ablegt, bevor sie serverintern an die zust√§ndige
                JSP weitergeleitet wird.
            </p>

            <p class="bigskip">
                <span class="nr">f)</span>
                Die Datei <tt>WEB-INF\tags\templates\base.tag</tt> definiert das HTML-Grundger√ºst aller Seiten innerhalb der
                Webanwendung. Dadurch muss in den einzelnen JSPs nur noch der HTML-Code ausprogrammiert werden, der von Seite
                zu Seite unterschiedlich ist. Die <tt>base.tag</tt> wird zu diesem Zweck √ºber das Element <tt>&lt;template:base&gt;</tt>
                in den JSP-Dateien aufgerufen.
            </p>

            <p class="bigskip">
                <span class="nr">g)</span>
                Schritte im <tt>TaskEditServlet</tt> beim Speichern eines Datensatzes:
            </p>
            <ol class="spacing">
                <li>
                    Zun√§chst wird in <tt>doPost()</tt> gerpf√ºt, ob im Parameter <tt>action</tt> der Wert <tt>save</tt>
                    oder <tt>delete</tt> mitgegeben wurde. Je nach Wert wird dann die Methode <tt>saveTask()</tt> oder
                    <tt>deleteTask</tt> aufgerufen.
                </li>
                <li>
                    In <tt>saveTask()</tt> werden dann zun√§chst alle Formularfelder ausgelesen und in Stringfelder geschrieben.
                </li>
                <li>
                    Danach wird <tt>getRequestedTask()</tt> aufgerufen, um anhand der URL entweder das zu bearbeitende
                    <tt>Task</tt>-Objekt auszulesen oder eine neue Objektinstanz zu erzeugen.
                </li>
                <li>
                    Anschlie√üend werden die eingegebenen Werte an das ermittelte <tt>Task</tt>-Objekt √ºbergeben.
                    Kommt es dabei zu Fehlern, wie zum Beispiel dass das Datum oder die Uhrzeit nicht interpretiert
                    werden k√∂nnen, werden diese in die Fehlerliste aufgenommen.
                </li>
                <li>
                    Das <tt>Task</tt>-Objekt wird mit der <tt>ValidationBean</tt> √ºberpr√ºft.
                </li>
                <li>
                    Falls keine Fehler gefunden wurden, wird der Datensatz gespeichert und der Anwender zur
                    Startseite weitergeleitet.
                </li>
                <li>
                    Falls es Fehler gab, werden die bisherigen Formulareingaben und gefundenen Fehler in der HTTP-Session
                    abgelegt und das Erfassungsformular erneut angezeigt.
                </li>
            </ol>
        </div>

        <div class="container">
            <h2>2. Benutzerauthentifizierung</h2>

            <p>
                <span class="nr">a)</span>
                Konfiguration in der Datei <tt>Web Pages\WEB-INF\web.xml</tt>:
            </p>
            <table>
                <thead>
                    <tr>
                        <th>
                            XML-Element
                        </th>
                        <th>
                            Bedeutung
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td>
                        <tt>&lt;security-constraint&gt;</tt>
                    </td>
                    <td>
                        Hier wird definiert, dass alle URLs, die mit <tt>/app/*</tt>
                        beginnen nur von Benutzern aufgerufen werden k√∂nnen, die die Rolle <tt>app-user</tt> besitzen.
                        Der Aufruf muss zus√§tzlich √ºber eine gesicherte HTTPS-Verbindung erfolgen.
                    </td>
                </tr>
                <tr>
                    <td>
                        <tt>&lt;security-role&gt;</tt>
                    </td>
                    <td>
                        Hier wird die Rolle <tt>app-user</tt> definiert.
                    </td>
                </tr>
                <tr>
                    <td>
                        <tt>&lt;login-config&gt;</tt>
                    </td>
                    <td>
                        Hier wird festgelegt, dass die Authentifizierung √ºber ein Login-Formular
                        erfolgt und es werden die JSP-Dateien f√ºr das Formular und die Fehlerseite hinterlegt.
                    </td>
                </tr>
            </table>

            <p class="bigskip">
                <span class="nr">b)</span>
                Die Tabelle mit den Benutzerdaten wird in der Serverkonfiguration hinterlegt. Im Fall von TomEE
                in der Datei <tt>META-INF/context.xml</tt> im Ordner <tt>Web</tt> <tt>Pages</tt>.
            </p>

            <p class="bigskip">
                <span class="nr">c)</span>
                Zus√§tzlicher Code zur Definition einer weiteren Benutzerrolle:
            </p>
            <code style="font-weight: normal;">
                <b>&lt;security-role&gt;</b> <br />
                &nbsp;&nbsp; <b>&lt;description&gt;</b> <br />
                &nbsp;&nbsp; &nbsp;&nbsp; Beschreibung ‚Ä¶ <br />
                &nbsp;&nbsp;<b>&lt;/description&gt;</b> <br />
                &nbsp;&nbsp;<b>&lt;role-name&gt;</b> <br />
                &nbsp;&nbsp; &nbsp;&nbsp; name-der-rolle <br />
                &nbsp;&nbsp;<b>&lt;/role-name&gt;</b> <br />
                <b>&lt;/security-role&gt;</b> <br />
            </code>

            <p class="bigskip">
                <span class="nr">d)</span>
                Zur Pr√ºfung der neuen Rolle kann die Annotation <tt>@RolesAllowed("name-der-rolle")</tt> verwendet werden.
            </p>
        </div>

        <div class="container">
            <h2>3. √úberpr√ºfung der Benutzereingaben</h2>

            <p>
                <span class="nr">a)</span>
                Verwendete Annotationen zur Beanvalidierung:
            </p>
            <table>
                <thead>
                    <tr>
                        <th>
                            Annotation
                        </th>
                        <th>
                            Aufgabe
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td>
                        <tt>@NotNull</tt>
                    </td>
                    <td>
                        Stellt sicher, dass der Wert niemals <tt>null</tt> sein darf.
                    </td>
                </tr>
                <tr>
                    <td>
                        <tt>@Size</tt>
                    </td>
                    <td>
                        Legt die Mindest- und Maximall√§nge eines Wertes fest.
                    </td>
                </tr>
            </table>

            <p class="bigskip">
                <span class="nr">b)</span>
                Weitere, nicht im Quellcode verwendete Annotationen:
                <a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/constraints/package-summary.html" target="_blank">Siehe hier</a>
            </p>

            <p class="bigskip">
                <span class="nr">c)</span>
                M√∂gliche Vorteile aus der Nutzung von Bean Validation, auch in Hinblick auf unterschiedliche
                Clients der Anwendung:
            </p>
            <ol class="spacing">
                <li>
                    Es muss weniger Quellcode geschrieben werden, die meisten <tt>if</tt>-Abfragen k√∂nnen durch
                    einfache Annotationen ersetzt werden.
                </li>
                <li>
                    Die Annotationen werden direkt bei den Entity-Klassen hinzugef√ºgt, da es um die Eigenschaften
                    ihrer Felder geht. Es finden kaum noch manuelle Pr√ºfungen in den Servlets statt.
                </li>
                <li>
                    Dadurch m√ºssen die Pr√ºfungen auch nicht f√ºr jeden Client aufs Neue programmiert werden, was
                    beim alten Vorgehen der Fall w√§re, da alle Clients zwar die EJBs oft aber nicht die Servlets
                    der Anwendung nutzen k√∂nnen.
                </li>
            </ol>
        </div>
    </body>
</html>
